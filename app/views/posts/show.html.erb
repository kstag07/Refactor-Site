<head>
  <link href='http://fonts.googleapis.com/css?family=Questrial' rel='stylesheet' type='text/css'>
  <%= stylesheet_link_tag 'reset.css', 'module.css', 'base.css', 'layout.css', 'typography.css', media: "all", "data-turbolinks-track" => true %>
</head>

<main class="flex-main">
<!-- This is where the original post will show when the refactor link is accessed from the main index view -->
<article class="postview">
  <section>
    <h3 class="postview">
      <%= @post.title %>
    </h3>
    <a class="language-tag">
      <%= Post::LANGUAGE_OPTIONS[@post.language] %>
    </a>
    <pre class="originalpost-code">
      <%= markdown @post.body %>
    </pre>
    <a href="#postrefactor" class="button">Refactor This</a>
  </section>
</article>

<!-- This is where the base part of the view starts with the refactors generated by users  everything in this has the gray background -->

<div class="post-refactors">
  <article>
    <div class="flex-postcontainer">

<!-- Each of the "refactorpost" is an individual user generated refactor -->
      <% @post.comments.each do |comment| %>
        <% unless comment.new_record? %>
          <section class="refactorpost">
            <div class="flex-vote">
              <a href="#">
                <svg class="voteup" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 26.279 13.502" enable-background="new 0 0 26.279 13.502" xml:space="preserve">
                <polygon points="0,13.5 13.1,0 26.3,13.5"/>
                </svg>
              </a>
              <span class="votecounter">vote count</span>
              <a href="#" class="votedown"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 26.279 13.502" enable-background="new 0 0 26.279 13.502" xml:space="preserve">
              <polygon points="26.3,0 13.1,13.5 0,0"/>
              </svg>
              </a>
            </div>
            <div class="flex-refactorpost">
              <h4><%= comment.author.name %></h4>
              <pre class="refactorpost-code">
                <%= markdown comment.content %>
              </pre>
            </div>
            <div>
              <% if current_user.present? && (current_user.mod? || (current_user.author? &&  @post.author == current_user)) %>
              <%= link_to 'Edit Refactor', edit_post_comment_path(@post, comment) %>
              <%= link_to 'Delete', post_comment_path(@post, comment), method: :delete, data: { confirm: 'Are you sure?' } %>
            </div>
            <% end %>
          </section>
        <% end %>
      <% end %>

    </div>
  </article>
</div>

  <article class="flex-formcontainer">
    <section class="new-form">
        <div>
          <label><h3>Post your refactor code:</h3></label>
          <% if current_user.present? %>
          <%= render 'comments/form' %>
          <a name="postrefactor"></a>
          <% end %>
        </div>
    </section>
  </article>
</main>

<p>
  <% if current_user.present? && (current_user.mod? || (current_user.author? &&  @post.author == current_user)) %>
    <%= link_to 'Edit', edit_post_path(@post) %> |
    <%= link_to 'Destroy Post', post_path(@post), method: :delete, data: { confirm: 'Are you sure you want to destroy this post?' } %> |
  <% end %>
  <%= link_to 'Back', posts_path %>
</p>


