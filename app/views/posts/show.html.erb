<main class="flex-main">
<!-- This is where the original post will show when the refactor link is accessed from the main index view -->
<article class="postview">
  <section>
    <h3 class="postview"><%= @post.title %></h3>
    <h3 class="username"><%= @post.author.name %></h3>
    <a class="language-tag">
      <%= Post::LANGUAGE_OPTIONS[@post.language] %>
    </a>
    <pre>
      <%= markdown @post.body %>
    </pre>
    <p>
      <% if current_user.present? && (current_user.mod? || (current_user.author? &&  @post.author == current_user)) %>
        <%= link_to 'Edit Post', edit_post_path(@post) %> |
        <%= link_to 'Destroy Post', post_path(@post), method: :delete, data: { confirm: 'Are you sure you want to destroy this post?' } %>
      <% end %>
    </p>
    <% if current_user.present? %>
      <a href="#postrefactor" class="button">Refactor This</a>
    <% else %>
      <%= link_to "Refactor This", new_user_session_path, class: "button" %>
    <% end %>
  </section>
</article>

<!-- This is where the base part of the view starts with the refactors generated by users  everything in this has the gray background -->

<div class="post-refactors">
  <article>
    <div class="flex-postcontainer">

<!-- Each of the "refactorpost" is an individual user generated refactor -->
      <% @post.comments.each do |comment| %>
        <% unless comment.new_record? %>
          <section class="refactorpost">
            <div class="flex-vote">
              <a>
                <%= link_to "Upvote", upvote_post_comment_path(@post, comment), method: :put %>
                <svg class="voteup" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 26.279 13.502" enable-background="new 0 0 26.279 13.502" xml:space="preserve">
                <polygon points="0,13.5 13.1,0 26.3,13.5"/>
                </svg>
              </a>
              <span class="votecounter"><%= comment.votes_for.size %></span>
              <a>
                <svg class="votedown" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 26.279 13.502" enable-background="new 0 0 26.279 13.502" xml:space="preserve">
                <polygon points="26.3,0 13.1,13.5 0,0"/>
                </svg>
                <%= link_to "Downvote", downvote_post_comment_path(@post, comment), method: :put %>
              </a>
            </div>
            <div class="flex-refactorpost">
              <h4 class="username"><%= comment.author.name %></h4>
              <pre>
                <%= markdown comment.content %>
              </pre>
              <p>
                <% if current_user.present? && (current_user.mod? || (current_user.author? &&  @post.author == current_user)) %>
                <%= link_to 'Edit Refactor |', edit_post_comment_path(@post, comment) %>
                <%= link_to 'Delete', post_comment_path(@post, comment), method: :delete, data: { confirm: 'Are you sure?' } %>
                <% end %>
            </div>
          </section>
        <% end %>
      <% end %>

    </div>
  </article>
</div>

  <article class="flex-formcontainer">
    <section class="new-form">
      <form class="new-post">
        <div>
          <label><h3>Post your refactor code:</h3></label>
          <%= render 'comments/form' %>
          <a name="postrefactor"></a>
        </div>
      </form>
    </section>
  </article>
</main>

<p>
 <% if current_user.present? && (current_user.mod? || (current_user.author? &&  @post.author == current_user)) %>
   <%= link_to 'Edit', edit_post_path(@post) %> |
   <%= link_to 'Destroy Post', post_path(@post), method: :delete, data: { confirm: 'Are you sure you want to destroy this post?' } %> |
 <% end %>
 <%= link_to 'Home', posts_path %>
</p>
 
<p>
  <% @post.comments.each do |comment| %>
    <% unless comment.new_record? %>
      <%= comment.author.name %>
      <%= comment.content %>
    <% end %>
  <% end %>
</p>
